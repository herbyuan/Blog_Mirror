<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ICS02 Bomblab | H's Blog</title><meta name="author" content="Herbert"><meta name="copyright" content="Herbert"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Bomblab是第二个lab，简单来说任务就是通过阅读反汇编得到的代码和GDB调试，输入正确的字符串以过关，错误则可能会引爆炸弹。 看着好像很恐怖，引爆一次炸弹就要扣除最终一定的分数，但其实丝毫不用担心。一方面虽然lab本来是做过处理只能在服务器上运行的，但是只要找到合适的入口你就可以跳过服务器检测从而在本地拆弹，另一方面只要会设置断点，每次都在explode_bomb（引爆炸弹函数）处设断点，该">
<meta property="og:type" content="article">
<meta property="og:title" content="ICS02 Bomblab">
<meta property="og:url" content="https://blog.zhuoyuan-he.cn/ICS02-Bomblab/index.html">
<meta property="og:site_name" content="H&#39;s Blog">
<meta property="og:description" content="Bomblab是第二个lab，简单来说任务就是通过阅读反汇编得到的代码和GDB调试，输入正确的字符串以过关，错误则可能会引爆炸弹。 看着好像很恐怖，引爆一次炸弹就要扣除最终一定的分数，但其实丝毫不用担心。一方面虽然lab本来是做过处理只能在服务器上运行的，但是只要找到合适的入口你就可以跳过服务器检测从而在本地拆弹，另一方面只要会设置断点，每次都在explode_bomb（引爆炸弹函数）处设断点，该">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.zhuoyuan-he.cn/linear-gradient(20deg,%20#0062be,%20#925696,%20#cc426e,%20#fb0347)">
<meta property="article:published_time" content="2023-02-07T13:02:51.000Z">
<meta property="article:modified_time" content="2023-03-09T15:43:31.609Z">
<meta property="article:author" content="Herbert">
<meta property="article:tag" content="ICS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.zhuoyuan-he.cn/linear-gradient(20deg,%20#0062be,%20#925696,%20#cc426e,%20#fb0347)"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.zhuoyuan-he.cn/ICS02-Bomblab/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ICS02 Bomblab',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-09 23:43:31'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/selfie.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">H's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ICS02 Bomblab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-07T13:02:51.000Z" title="发表于 2023-02-07 21:02:51">2023-02-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-09T15:43:31.609Z" title="更新于 2023-03-09 23:43:31">2023-03-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ICS02 Bomblab"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Bomblab是第二个lab，简单来说任务就是通过阅读反汇编得到的代码和GDB调试，输入正确的字符串以过关，错误则可能会引爆炸弹。</p>
<p>看着好像很恐怖，引爆一次炸弹就要扣除最终一定的分数，但其实丝毫不用担心。一方面虽然lab本来是做过处理只能在服务器上运行的，但是只要找到合适的入口你就可以跳过服务器检测从而在本地拆弹，另一方面只要会设置断点，每次都在explode_bomb（引爆炸弹函数）处设断点，该收手时就收手，根本不用担心炸弹爆炸。但是我不推荐第一种方式，因为要是你有这种绕过服务器检测函数的水平，这个lab对你来说应该是没有难度的，正常做就好了。</p>
<p>有一点十分遗憾的是，在我写这个解析的时候服务器已经关掉了，而且我也并不会修改HEX使得炸弹在本地运行。于是我只能分析拆弹的流程，不能给出具体运行的截图，在此说一声抱歉。</p>
<p>很多网上的解析上来就说啊好你看这六个阶段每个阶段怎么怎么做，隐藏炸弹怎么怎么进。但是我在做lab时每次最先遇到的问题都不是题目本身，而是怎么理解接近十页的writeup，怎么开始。Bomblab最基本的工具就是GDB和SSH，但是大部分的解析几乎都略过了这一部分，所以我当时甚至要花很长时间才能搞明白怎么得到反汇编的文件，唉。</p>
<p>下载得到自己编号的lab之后，使用objdump生成汇编文件，使用命令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>b</mi><mi>j</mi><mi>d</mi><mi>u</mi><mi>m</mi><mi>p</mi><mo>−</mo><mi>d</mi><mi>b</mi><mi>o</mi><mi>m</mi><mi>b</mi><mo>&gt;</mo><mi>b</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>a</mi><mi>s</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">objdump -d bomb &gt; bomb.asm</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.05724em;">bj</span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">b</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mb</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mb</span><span class="mord">.</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">m</span></span></span></span>，将bomb可执行文件反汇编并写入bomb.asm文件，可以看到每个phase对应一个函数，我们的目的就是通过阅读汇编代码研究怎样的输入可以不调用函数explode_bomb而正常退出。</p>
<p>第二个重要的工具是SSH，因为程序需要在远程服务器上运行。具体的登录方式下发的文件里面应该有，稍微学习一下即可。</p>
<p>关于gdb工具的使用，个人感觉不用知道太多，会设置断点，看寄存器内容就差不多了。其他指令可以在说明文档中找到，但是不用也没有关系。常用指令如下：</p>
<ul>
<li><code>gdb bomb</code> 用gdb打开bomb</li>
<li><code>r</code> 运行可执行文件</li>
<li><code>b func</code> 在函数func开始处设置断点</li>
<li><code>b *0xFFFF</code> 在地址0xFFFF处设置断点</li>
<li><code>si</code> 从断点处逐句执行</li>
<li><code>x/s *0xFFFF</code> 以字符串形式输出给定地址存放的值</li>
<li><code>info r</code> 展示所有寄存器的信息</li>
</ul>
<p>最后也是最重要的一点——<code>Ctrl+C</code>。任何时候感觉不对，直接终止gdb进程，或者也可以输入<code>kill</code>指令终止运行中的bomb程序。</p>
<h2 id="phase-1">phase 1</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">000000000000130d &lt;phase_1&gt;:</span><br><span class="line">    130d: 48 83 ec 08           sub    $0x8,%rsp</span><br><span class="line">    1311: 48 8d 35 f8 19 00 00  lea    0x19f8(%rip),%rsi        # 2d10 &lt;_IO_stdin_used+0x190&gt;</span><br><span class="line">    1318: e8 92 04 00 00        callq  17af &lt;strings_not_equal&gt;</span><br><span class="line">    131d: 85 c0                 test   %eax,%eax</span><br><span class="line">    131f: 75 05                 jne    1326 &lt;phase_1+0x19&gt;</span><br><span class="line">    1321: 48 83 c4 08           add    $0x8,%rsp</span><br><span class="line">    1325: c3                    retq   </span><br><span class="line">    1326: e8 a1 07 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    132b: eb f4                 jmp    1321 &lt;phase_1+0x14&gt;</span><br></pre></td></tr></table></figure>
<p>这是一个热身环节。看到函数strings_not_equal，且之后不等于0就要跳转到explode_bomb，得知这肯定是要输入一个字符串与某个存在的字符串匹配，这个字符串的地址应该存放在0x19f8(%rip)中，但是%rip要在运行中才能知道。</p>
<p>这是一个热身环节。看到函数strings_not_equal，且之后不等于0就要跳转到explode_bomb，得知这肯定是要输入一个字符串与某个存在的字符串匹配，这个字符串的地址应该存放在0x19f8(%rip)中，但是%rip要在运行中才能知道。</p>
<h2 id="phase-2">phase 2</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">000000000000132d &lt;phase_2&gt;:</span><br><span class="line">    132d: 53                    push   %rbx</span><br><span class="line">    132e: 48 83 ec 20           sub    $0x20,%rsp</span><br><span class="line">    1332: 64 48 8b 04 25 28 00  mov    %fs:0x28,%rax</span><br><span class="line">    1339: 00 00 </span><br><span class="line">    133b: 48 89 44 24 18        mov    %rax,0x18(%rsp)</span><br><span class="line">    1340: 31 c0                 xor    %eax,%eax</span><br><span class="line">    1342: 48 89 e6              mov    %rsp,%rsi</span><br><span class="line">    1345: e8 02 08 00 00        callq  1b4c &lt;read_six_numbers&gt;</span><br><span class="line">    134a: 83 3c 24 01           cmpl   $0x1,(%rsp)</span><br><span class="line">    134e: 75 07                 jne    1357 &lt;phase_2+0x2a&gt;</span><br><span class="line">    1350: bb 01 00 00 00        mov    $0x1,%ebx</span><br><span class="line">    1355: eb 0a                 jmp    1361 &lt;phase_2+0x34&gt;</span><br><span class="line">    1357: e8 70 07 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    135c: eb f2                 jmp    1350 &lt;phase_2+0x23&gt;</span><br><span class="line">    135e: 83 c3 01              add    $0x1,%ebx</span><br><span class="line">    1361: 83 fb 05              cmp    $0x5,%ebx</span><br><span class="line">    1364: 7f 19                 jg     137f &lt;phase_2+0x52&gt;</span><br><span class="line">    1366: 48 63 d3              movslq %ebx,%rdx</span><br><span class="line">    1369: 8d 43 ff              lea    -0x1(%rbx),%eax</span><br><span class="line">    136c: 48 98                 cltq   </span><br><span class="line">    136e: 8b 04 84              mov    (%rsp,%rax,4),%eax</span><br><span class="line">    1371: 01 c0                 add    %eax,%eax</span><br><span class="line">    1373: 39 04 94              cmp    %eax,(%rsp,%rdx,4)</span><br><span class="line">    1376: 74 e6                 je     135e &lt;phase_2+0x31&gt;</span><br><span class="line">    1378: e8 4f 07 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    137d: eb df                 jmp    135e &lt;phase_2+0x31&gt;</span><br><span class="line">    137f: 48 8b 44 24 18        mov    0x18(%rsp),%rax</span><br><span class="line">    1384: 64 48 33 04 25 28 00  xor    %fs:0x28,%rax</span><br><span class="line">    138b: 00 00 </span><br><span class="line">    138d: 75 06                 jne    1395 &lt;phase_2+0x68&gt;</span><br><span class="line">    138f: 48 83 c4 20           add    $0x20,%rsp</span><br><span class="line">    1393: 5b                    pop    %rbx</span><br><span class="line">    1394: c3                    retq   </span><br><span class="line">    1395: e8 46 fb ff ff        callq  ee0 &lt;__stack_chk_fail@plt&gt;</span><br></pre></td></tr></table></figure>
<p>提示非常明显了，有个函数叫做read_six_numbers，所以输入肯定是六个数，阅读具体代码可知如果读入的不是六个数就会引爆炸弹。</p>
<p>正常输入下应该进入到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1350</mn></mrow><annotation encoding="application/x-tex">1350</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1350</span></span></span></span>这一行，注意这里ebx寄存器中放入了$$0x1$。ebx在小于等于5时执行。</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1369</mn></mrow><annotation encoding="application/x-tex">1369</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1369</span></span></span></span>将rbx-1放入eax作为偏移，之后<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>136</mn><mi>e</mi></mrow><annotation encoding="application/x-tex">136e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">136</span><span class="mord mathnormal">e</span></span></span></span>将栈中对应元素放入eax，然后自己加自己。之后比较这个数与之后的那个数是否相等。到此我们就知道了这个数组要求后一个数是前一个数的两倍，所以构造一个等比数列就能满足要求了。</p>
<p>所以答案是 <code>1 2 4 8 16 32</code>.</p>
<h2 id="phase-3">phase 3</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">000000000000139a &lt;phase_3&gt;:</span><br><span class="line">    139a: 48 83 ec 18           sub    $0x18,%rsp</span><br><span class="line">    139e: 64 48 8b 04 25 28 00  mov    %fs:0x28,%rax</span><br><span class="line">    13a5: 00 00 </span><br><span class="line">    13a7: 48 89 44 24 08        mov    %rax,0x8(%rsp)</span><br><span class="line">    13ac: 31 c0                 xor    %eax,%eax</span><br><span class="line">    13ae: 48 8d 4c 24 04        lea    0x4(%rsp),%rcx</span><br><span class="line">    13b3: 48 89 e2              mov    %rsp,%rdx</span><br><span class="line">    13b6: 48 8d 35 eb 1c 00 00  lea    0x1ceb(%rip),%rsi        # 30a8 &lt;array.3419+0x308&gt;</span><br><span class="line">    13bd: e8 ce fb ff ff        callq  f90 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">    13c2: 83 f8 01              cmp    $0x1,%eax</span><br><span class="line">    13c5: 7e 1d                 jle    13e4 &lt;phase_3+0x4a&gt;</span><br><span class="line">    13c7: 83 3c 24 07           cmpl   $0x7,(%rsp)</span><br><span class="line">    13cb: 0f 87 99 00 00 00     ja     146a &lt;phase_3+0xd0&gt;</span><br><span class="line">    13d1: 8b 04 24              mov    (%rsp),%eax</span><br><span class="line">    13d4: 48 8d 15 a5 19 00 00  lea    0x19a5(%rip),%rdx        # 2d80 &lt;_IO_stdin_used+0x200&gt;</span><br><span class="line">    13db: 48 63 04 82           movslq (%rdx,%rax,4),%rax</span><br><span class="line">    13df: 48 01 d0              add    %rdx,%rax</span><br><span class="line">    13e2: ff e0                 jmpq   *%rax</span><br><span class="line">    13e4: e8 e3 06 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    13e9: eb dc                 jmp    13c7 &lt;phase_3+0x2d&gt;</span><br><span class="line">    13eb: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    13f0: eb 05                 jmp    13f7 &lt;phase_3+0x5d&gt;</span><br><span class="line">    13f2: b8 b3 02 00 00        mov    $0x2b3,%eax</span><br><span class="line">    13f7: 2d e5 03 00 00        sub    $0x3e5,%eax</span><br><span class="line">    13fc: 05 a4 02 00 00        add    $0x2a4,%eax</span><br><span class="line">    1401: 2d a1 02 00 00        sub    $0x2a1,%eax</span><br><span class="line">    1406: 05 a1 02 00 00        add    $0x2a1,%eax</span><br><span class="line">    140b: 2d a1 02 00 00        sub    $0x2a1,%eax</span><br><span class="line">    1410: 05 a1 02 00 00        add    $0x2a1,%eax</span><br><span class="line">    1415: 2d a1 02 00 00        sub    $0x2a1,%eax</span><br><span class="line">    141a: 83 3c 24 05           cmpl   $0x5,(%rsp)</span><br><span class="line">    141e: 7f 06                 jg     1426 &lt;phase_3+0x8c&gt;</span><br><span class="line">    1420: 39 44 24 04           cmp    %eax,0x4(%rsp)</span><br><span class="line">    1424: 74 05                 je     142b &lt;phase_3+0x91&gt;</span><br><span class="line">    1426: e8 a1 06 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    142b: 48 8b 44 24 08        mov    0x8(%rsp),%rax</span><br><span class="line">    1430: 64 48 33 04 25 28 00  xor    %fs:0x28,%rax</span><br><span class="line">    1437: 00 00 </span><br><span class="line">    1439: 75 3b                 jne    1476 &lt;phase_3+0xdc&gt;</span><br><span class="line">    143b: 48 83 c4 18           add    $0x18,%rsp</span><br><span class="line">    143f: c3                    retq   </span><br><span class="line">    1440: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    1445: eb b5                 jmp    13fc &lt;phase_3+0x62&gt; </span><br><span class="line">    1447: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    144c: eb b3                 jmp    1401 &lt;phase_3+0x67&gt;</span><br><span class="line">    144e: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    1453: eb b1                 jmp    1406 &lt;phase_3+0x6c&gt;</span><br><span class="line">    1455: b8 00 00 00 00        mov    $0x0,%eax        // 3 ?</span><br><span class="line">    145a: eb af                 jmp    140b &lt;phase_3+0x71&gt;</span><br><span class="line">    145c: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    1461: eb ad                 jmp    1410 &lt;phase_3+0x76&gt;</span><br><span class="line">    1463: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    1468: eb ab                 jmp    1415 &lt;phase_3+0x7b&gt;</span><br><span class="line">    146a: e8 5d 06 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    146f: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    1474: eb a4                 jmp    141a &lt;phase_3+0x80&gt;</span><br><span class="line">    1476: e8 65 fa ff ff        callq  ee0 &lt;__stack_chk_fail@plt&gt;</span><br></pre></td></tr></table></figure>
<p>看到这里应该有很多人都发现了前面四行几乎在每个phase都有出现，这部分的作用是先开一个栈内的空间，然后放入金丝雀值，在函数结束的时候检验金丝雀值是否被修改，如果修改了说明栈爆了，于是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>c</mi><msub><mi>k</mi><mi>c</mi></msub><mi>h</mi><msub><mi>k</mi><mi>f</mi></msub><mi>a</mi><mi>i</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">stack_chk_fail</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">h</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord mathnormal">ai</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span>。这部分内容在attacklab中会有更加详细的应用，而且这个值也不能保证栈没有溢出，毕竟有很多方法可以绕过这玩意。</p>
<p>这里的读取函数是scanf，参数放在0x1ceb(%rip)，运行到这里时用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi mathvariant="normal">/</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">x/s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mord">/</span><span class="mord mathnormal">s</span></span></span></span>命令查看这个字符串，发现是&quot;%d %d&quot;，说明要输入的是两个整数。这两个数放在栈中，分别是(%rsp)和0x4(%rsp)。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>13</mn><mi>c</mi><mn>7</mn></mrow><annotation encoding="application/x-tex">13c7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">13</span><span class="mord mathnormal">c</span><span class="mord">7</span></span></span></span>表示如果7小于第一个输入的数，就会引爆炸弹，所以第一个数小于等于7。之后这个数又作为地址的偏移，决定了将要执行哪个位置的代码。理论上程序应该改执行<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>13</mn><mi>e</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">13eb</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">13</span><span class="mord mathnormal">e</span><span class="mord mathnormal">b</span></span></span></span>位置的代码，之后是对eax寄存器的一顿操作。如果5小于第一个输入的数就要引爆炸弹，这样就确定了第一个数只能是5或者6或者7。第二个数需要和eax中的数相同。到此这个炸弹就可以拆了。尝试第一个数为5或者6或者7，看看能否跳转到正常的对于eax的操作过程，然后单步执行到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1420</mn></mrow><annotation encoding="application/x-tex">1420</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1420</span></span></span></span>位置，查看eax的值（这样就不用人工计算了）。退出程序后重新开始一次，输入正确的值即可拆弹。</p>
<p>最终的答案是 <code>5 -673</code>.</p>
<h2 id="phase-4">phase 4</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">000000000000147b &lt;func4&gt;:</span><br><span class="line">    147b: 48 83 ec 08           sub    $0x8,%rsp</span><br><span class="line">    147f: 89 d1                 mov    %edx,%ecx</span><br><span class="line">    1481: 29 f1                 sub    %esi,%ecx</span><br><span class="line">    1483: 89 c8                 mov    %ecx,%eax</span><br><span class="line">    1485: c1 e8 1f              shr    $0x1f,%eax</span><br><span class="line">    1488: 01 c8                 add    %ecx,%eax</span><br><span class="line">    148a: d1 f8                 sar    %eax</span><br><span class="line">    148c: 01 f0                 add    %esi,%eax</span><br><span class="line">    148e: 39 f8                 cmp    %edi,%eax</span><br><span class="line">    1490: 7f 0e                 jg     14a0 &lt;func4+0x25&gt;</span><br><span class="line">    1492: 39 f8                 cmp    %edi,%eax</span><br><span class="line">    1494: 7c 16                 jl     14ac &lt;func4+0x31&gt;</span><br><span class="line">    1496: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    149b: 48 83 c4 08           add    $0x8,%rsp</span><br><span class="line">    149f: c3                    retq   </span><br><span class="line">    14a0: 8d 50 ff              lea    -0x1(%rax),%edx</span><br><span class="line">    14a3: e8 d3 ff ff ff        callq  147b &lt;func4&gt;</span><br><span class="line">    14a8: 01 c0                 add    %eax,%eax</span><br><span class="line">    14aa: eb ef                 jmp    149b &lt;func4+0x20&gt;</span><br><span class="line">    14ac: 8d 70 01              lea    0x1(%rax),%esi</span><br><span class="line">    14af: e8 c7 ff ff ff        callq  147b &lt;func4&gt;</span><br><span class="line">    14b4: 8d 44 00 01           lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">    14b8: eb e1                 jmp    149b &lt;func4+0x20&gt;</span><br><span class="line"></span><br><span class="line">00000000000014ba &lt;phase_4&gt;:</span><br><span class="line">    14ba: 48 83 ec 18           sub    $0x18,%rsp</span><br><span class="line">    14be: 64 48 8b 04 25 28 00  mov    %fs:0x28,%rax</span><br><span class="line">    14c5: 00 00 </span><br><span class="line">    14c7: 48 89 44 24 08        mov    %rax,0x8(%rsp)</span><br><span class="line">    14cc: 31 c0                 xor    %eax,%eax</span><br><span class="line">    14ce: 48 8d 4c 24 04        lea    0x4(%rsp),%rcx</span><br><span class="line">    14d3: 48 89 e2              mov    %rsp,%rdx</span><br><span class="line">    14d6: 48 8d 35 cb 1b 00 00  lea    0x1bcb(%rip),%rsi        # 30a8 &lt;array.3419+0x308&gt;</span><br><span class="line">    14dd: e8 ae fa ff ff        callq  f90 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">    14e2: 83 f8 02              cmp    $0x2,%eax</span><br><span class="line">    14e5: 75 0c                 jne    14f3 &lt;phase_4+0x39&gt;</span><br><span class="line">    14e7: 8b 04 24              mov    (%rsp),%eax</span><br><span class="line">    14ea: 85 c0                 test   %eax,%eax</span><br><span class="line">    14ec: 78 05                 js     14f3 &lt;phase_4+0x39&gt;</span><br><span class="line">    14ee: 83 f8 0e              cmp    $0xe,%eax</span><br><span class="line">    14f1: 7e 05                 jle    14f8 &lt;phase_4+0x3e&gt;</span><br><span class="line">    14f3: e8 d4 05 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    14f8: ba 0e 00 00 00        mov    $0xe,%edx</span><br><span class="line">    14fd: be 00 00 00 00        mov    $0x0,%esi</span><br><span class="line">    1502: 8b 3c 24              mov    (%rsp),%edi</span><br><span class="line">    1505: e8 71 ff ff ff        callq  147b &lt;func4&gt;</span><br><span class="line">    150a: 83 f8 05              cmp    $0x5,%eax</span><br><span class="line">    150d: 75 07                 jne    1516 &lt;phase_4+0x5c&gt;</span><br><span class="line">    150f: 83 7c 24 04 05        cmpl   $0x5,0x4(%rsp)</span><br><span class="line">    1514: 74 05                 je     151b &lt;phase_4+0x61&gt;</span><br><span class="line">    1516: e8 b1 05 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    151b: 48 8b 44 24 08        mov    0x8(%rsp),%rax</span><br><span class="line">    1520: 64 48 33 04 25 28 00  xor    %fs:0x28,%rax</span><br><span class="line">    1527: 00 00 </span><br><span class="line">    1529: 75 05                 jne    1530 &lt;phase_4+0x76&gt;</span><br><span class="line">    152b: 48 83 c4 18           add    $0x18,%rsp</span><br><span class="line">    152f: c3                    retq   </span><br><span class="line">    1530: e8 ab f9 ff ff        callq  ee0 &lt;__stack_chk_fail@plt&gt;</span><br></pre></td></tr></table></figure>
<p>跟上一个phase一样，查看字符串发现输入应该是两个整数（记为x和y），分别放在(%rsp)和0x4(%rsp)中。</p>
<p>第一个数放到eax中，等于0引爆炸弹，大于0xe引爆炸弹。edx=0xe，esi=0，edi=x，然后调用函数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">func4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord">4</span></span></span></span>。注意函数传参的顺序为rdi，rsi，rdx，rcx。函数的返回值不等于5就会引爆炸弹。第二个数不等于5就会引爆炸弹。</p>
<p>接下来看<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">func4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord">4</span></span></span></span>，这是一个递归调用的过程。可以转换成<code>C</code>来写一遍。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> edi = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> esi = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> edx = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> ecx = <span class="number">0</span>;    </span><br><span class="line"><span class="type">int</span> eax;</span><br><span class="line"><span class="type">int</span> <span class="title function_">func4</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    ecx = edx;</span><br><span class="line">    ecx -= esi;</span><br><span class="line">    eax = ecx;</span><br><span class="line">    eax &gt;&gt;= <span class="number">0x1f</span>;</span><br><span class="line">    eax += ecx;</span><br><span class="line">    eax &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    eax += esi;</span><br><span class="line">    <span class="keyword">if</span> (eax &gt; edi)</span><br><span class="line">    &#123;</span><br><span class="line">        edx = eax - <span class="number">1</span>;</span><br><span class="line">        func4();</span><br><span class="line">        eax += eax;</span><br><span class="line">        <span class="keyword">return</span> eax;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (eax &lt; edi)</span><br><span class="line">    &#123;</span><br><span class="line">        esi = eax + <span class="number">1</span>;</span><br><span class="line">        func4();</span><br><span class="line">        eax = eax + eax * <span class="number">1</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> eax;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        eax = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> eax;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">0xe</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        edi = i;</span><br><span class="line">        esi = <span class="number">0</span>;</span><br><span class="line">        edx = <span class="number">0xe</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\t%d\n&quot;</span>, i, func4());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>尝试第一个输入数的值使得func4返回值为5，得到i=10时成立。</p>
<p>答案是<code>10 5</code>.</p>
<h2 id="phase-5">phase 5</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">0000000000001535 &lt;phase_5&gt;:</span><br><span class="line">    1535: 53                    push   %rbx</span><br><span class="line">    1536: 48 89 fb              mov    %rdi,%rbx</span><br><span class="line">    1539: e8 5c 02 00 00        callq  179a &lt;string_length&gt;</span><br><span class="line">    153e: 83 f8 06              cmp    $0x6,%eax</span><br><span class="line">    1541: 75 0c                 jne    154f &lt;phase_5+0x1a&gt;</span><br><span class="line">    1543: b9 00 00 00 00        mov    $0x0,%ecx</span><br><span class="line">    1548: b8 00 00 00 00        mov    $0x0,%eax</span><br><span class="line">    154d: eb 1e                 jmp    156d &lt;phase_5+0x38&gt;</span><br><span class="line">    154f: e8 78 05 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    1554: eb ed                 jmp    1543 &lt;phase_5+0xe&gt;</span><br><span class="line">    1556: 48 63 d0              movslq %eax,%rdx</span><br><span class="line">    1559: 0f b6 14 13           movzbl (%rbx,%rdx,1),%edx</span><br><span class="line">    155d: 83 e2 0f              and    $0xf,%edx</span><br><span class="line">    1560: 48 8d 35 39 18 00 00  lea    0x1839(%rip),%rsi        # 2da0 &lt;array.3419&gt;</span><br><span class="line">    1567: 03 0c 96              add    (%rsi,%rdx,4),%ecx</span><br><span class="line">    156a: 83 c0 01              add    $0x1,%eax</span><br><span class="line">    156d: 83 f8 05              cmp    $0x5,%eax</span><br><span class="line">    1570: 7e e4                 jle    1556 &lt;phase_5+0x21&gt;</span><br><span class="line">    1572: 83 f9 43              cmp    $0x43,%ecx</span><br><span class="line">    1575: 74 05                 je     157c &lt;phase_5+0x47&gt;</span><br><span class="line">    1577: e8 50 05 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    157c: 5b                    pop    %rbx</span><br><span class="line">    157d: c3                    retq  </span><br></pre></td></tr></table></figure>
<p>字符串的长度为6。</p>
<p>存储在<code>*(%rbx)</code>开始处。</p>
<p>eax=0，ecx=0。eax&lt;=5时进循环</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rdx=eax</span><br><span class="line">edx=*(rbx+rdx)</span><br><span class="line">edx=edx &amp; <span class="number">0xf</span></span><br><span class="line">rsi=<span class="number">0x1839</span>(%rip)</span><br><span class="line">ecx+=*(%rsi+<span class="number">4</span>*%rdx)</span><br><span class="line">eax+=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>说明输入的字符串作为偏移的参数，使得最终ecx需要等于0x43。中间的有关%rip的数组需要运行起来才知道是什么，最后反正要把和凑成ecx=0x43。</p>
<p>对照数组找到合适的位置参数，然后转换成ASCII码对应的字符就可以，或者直接用特殊方法输入对应的ASCII码。答案并不唯一，输入 <code>SPEEEE</code> 即可.</p>
<h2 id="phase-6">phase 6</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">000000000000157e &lt;phase_6&gt;:</span><br><span class="line">    157e: 41 54                 push   %r12</span><br><span class="line">    1580: 55                    push   %rbp</span><br><span class="line">    1581: 53                    push   %rbx</span><br><span class="line">    1582: 48 83 ec 60           sub    $0x60,%rsp</span><br><span class="line">    1586: 64 48 8b 04 25 28 00  mov    %fs:0x28,%rax</span><br><span class="line">    158d: 00 00 </span><br><span class="line">    158f: 48 89 44 24 58        mov    %rax,0x58(%rsp)</span><br><span class="line">    1594: 31 c0                 xor    %eax,%eax</span><br><span class="line">    1596: 48 89 e6              mov    %rsp,%rsi</span><br><span class="line">    1599: e8 ae 05 00 00        callq  1b4c &lt;read_six_numbers&gt;</span><br><span class="line">    159e: bd 00 00 00 00        mov    $0x0,%ebp</span><br><span class="line">    15a3: eb 27                 jmp    15cc &lt;phase_6+0x4e&gt;</span><br><span class="line">    15a5: e8 22 05 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    15aa: eb 33                 jmp    15df &lt;phase_6+0x61&gt;</span><br><span class="line">    15ac: 83 c3 01              add    $0x1,%ebx</span><br><span class="line">    15af: 83 fb 05              cmp    $0x5,%ebx</span><br><span class="line">    15b2: 7f 15                 jg     15c9 &lt;phase_6+0x4b&gt;</span><br><span class="line">    15b4: 48 63 c5              movslq %ebp,%rax</span><br><span class="line">    15b7: 48 63 d3              movslq %ebx,%rdx</span><br><span class="line">    15ba: 8b 3c 94              mov    (%rsp,%rdx,4),%edi</span><br><span class="line">    15bd: 39 3c 84              cmp    %edi,(%rsp,%rax,4)</span><br><span class="line">    15c0: 75 ea                 jne    15ac &lt;phase_6+0x2e&gt;</span><br><span class="line">    15c2: e8 05 05 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    15c7: eb e3                 jmp    15ac &lt;phase_6+0x2e&gt;</span><br><span class="line">    15c9: 44 89 e5              mov    %r12d,%ebp</span><br><span class="line">    15cc: 83 fd 05              cmp    $0x5,%ebp</span><br><span class="line">    15cf: 7f 17                 jg     15e8 &lt;phase_6+0x6a&gt;</span><br><span class="line">    15d1: 48 63 c5              movslq %ebp,%rax</span><br><span class="line">    15d4: 8b 04 84              mov    (%rsp,%rax,4),%eax</span><br><span class="line">    15d7: 83 e8 01              sub    $0x1,%eax</span><br><span class="line">    15da: 83 f8 05              cmp    $0x5,%eax</span><br><span class="line">    15dd: 77 c6                 ja     15a5 &lt;phase_6+0x27&gt;</span><br><span class="line">    15df: 44 8d 65 01           lea    0x1(%rbp),%r12d</span><br><span class="line">    15e3: 44 89 e3              mov    %r12d,%ebx</span><br><span class="line">    15e6: eb c7                 jmp    15af &lt;phase_6+0x31&gt;</span><br><span class="line">    15e8: be 00 00 00 00        mov    $0x0,%esi</span><br><span class="line">    15ed: eb 17                 jmp    1606 &lt;phase_6+0x88&gt;</span><br><span class="line">    15ef: 48 8b 52 08           mov    0x8(%rdx),%rdx</span><br><span class="line">    15f3: 83 c0 01              add    $0x1,%eax</span><br><span class="line">    15f6: 48 63 ce              movslq %esi,%rcx</span><br><span class="line">    15f9: 39 04 8c              cmp    %eax,(%rsp,%rcx,4)</span><br><span class="line">    15fc: 7f f1                 jg     15ef &lt;phase_6+0x71&gt;</span><br><span class="line">    15fe: 48 89 54 cc 20        mov    %rdx,0x20(%rsp,%rcx,8)</span><br><span class="line">    1603: 83 c6 01              add    $0x1,%esi</span><br><span class="line">    1606: 83 fe 05              cmp    $0x5,%esi</span><br><span class="line">    1609: 7f 0e                 jg     1619 &lt;phase_6+0x9b&gt;</span><br><span class="line">    160b: b8 01 00 00 00        mov    $0x1,%eax</span><br><span class="line">    1610: 48 8d 15 f9 3a 20 00  lea    0x203af9(%rip),%rdx        # 205110 &lt;node1&gt;</span><br><span class="line">    1617: eb dd                 jmp    15f6 &lt;phase_6+0x78&gt;</span><br><span class="line">    1619: 48 8b 5c 24 20        mov    0x20(%rsp),%rbx</span><br><span class="line">    161e: 48 89 d9              mov    %rbx,%rcx</span><br><span class="line">    1621: b8 01 00 00 00        mov    $0x1,%eax</span><br><span class="line">    1626: eb 12                 jmp    163a &lt;phase_6+0xbc&gt;</span><br><span class="line">    1628: 48 63 d0              movslq %eax,%rdx</span><br><span class="line">    162b: 48 8b 54 d4 20        mov    0x20(%rsp,%rdx,8),%rdx</span><br><span class="line">    1630: 48 89 51 08           mov    %rdx,0x8(%rcx)</span><br><span class="line">    1634: 83 c0 01              add    $0x1,%eax</span><br><span class="line">    1637: 48 89 d1              mov    %rdx,%rcx</span><br><span class="line">    163a: 83 f8 05              cmp    $0x5,%eax</span><br><span class="line">    163d: 7e e9                 jle    1628 &lt;phase_6+0xaa&gt;</span><br><span class="line">    163f: 48 c7 41 08 00 00 00  movq   $0x0,0x8(%rcx)</span><br><span class="line">    1646: 00 </span><br><span class="line">    1647: bd 00 00 00 00        mov    $0x0,%ebp</span><br><span class="line">    164c: eb 07                 jmp    1655 &lt;phase_6+0xd7&gt;</span><br><span class="line">    164e: 48 8b 5b 08           mov    0x8(%rbx),%rbx</span><br><span class="line">    1652: 83 c5 01              add    $0x1,%ebp</span><br><span class="line">    1655: 83 fd 04              cmp    $0x4,%ebp</span><br><span class="line">    1658: 7f 11                 jg     166b &lt;phase_6+0xed&gt;</span><br><span class="line">    165a: 48 8b 43 08           mov    0x8(%rbx),%rax</span><br><span class="line">    165e: 8b 00                 mov    (%rax),%eax</span><br><span class="line">    1660: 39 03                 cmp    %eax,(%rbx)</span><br><span class="line">    1662: 7e ea                 jle    164e &lt;phase_6+0xd0&gt;</span><br><span class="line">    1664: e8 63 04 00 00        callq  1acc &lt;explode_bomb&gt;</span><br><span class="line">    1669: eb e3                 jmp    164e &lt;phase_6+0xd0&gt;</span><br><span class="line">    166b: 48 8b 44 24 58        mov    0x58(%rsp),%rax</span><br><span class="line">    1670: 64 48 33 04 25 28 00  xor    %fs:0x28,%rax</span><br><span class="line">    1677: 00 00 </span><br><span class="line">    1679: 75 09                 jne    1684 &lt;phase_6+0x106&gt;</span><br><span class="line">    167b: 48 83 c4 60           add    $0x60,%rsp</span><br><span class="line">    167f: 5b                    pop    %rbx</span><br><span class="line">    1680: 5d                    pop    %rbp</span><br><span class="line">    1681: 41 5c                 pop    %r12</span><br><span class="line">    1683: c3                    retq   </span><br><span class="line">    1684: e8 57 f8 ff ff        callq  ee0 &lt;__stack_chk_fail@plt&gt;</span><br></pre></td></tr></table></figure>
<p>最后一个phase比较复杂，看汇编还不能运行获得数据分析实在难度太大而且枯燥的分析过程还不如自己写一遍来得清楚，所以就不一步一步看了。</p>
<p>但是总的来说最后一个phase都是一个排序，只要按照冒泡排序的思路去理解问题就不大。</p>
<p>比如我这个就是给了六个数，需要给出顺序排列时这些数的分别应当处在的位置。实在做不出来的话可以尝试在找出六个数之后暴力尝试从大到小，从小到大或者相应数所在的位置，总能猜出一个答案来。</p>
<p>答案是 <code>2 5 4 1 6 3</code>.</p>
<hr>
<p>炸弹到此为止就拆完了。众所周知还有一个隐藏炸弹，但是不计分，所以看个人能力吧，我没做所以也就不讲了。</p>
<p>归根结底bomblab考察的是阅读汇编的能力，而这在之后的attacklab以及期中期末考试中都会用到，所以如果汇编水平欠缺的话抓紧补上吧。</p>
<p>最后还是提醒一句，不要过多关注奇技淫巧，还是要关注通用的解题方案，形成自己阅读汇编的模式。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://blog.zhuoyuan-he.cn">Herbert</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.zhuoyuan-he.cn/ICS02-Bomblab/">https://blog.zhuoyuan-he.cn/ICS02-Bomblab/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.zhuoyuan-he.cn" target="_blank">H's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ICS/">ICS</a></div><div class="post_share"><div class="social-share" data-image="/linear-gradient(20deg,%20#0062be,%20#925696,%20#cc426e,%20#fb0347)" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/ICS04-Archlab/"><img class="prev-cover" src="/linear-gradient(20deg,%20#0062be,%20#925696,%20#cc426e,%20#fb0347)" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ICS04 Archlab</div></div></a></div><div class="next-post pull-right"><a href="/ICS03-Attacklab/"><img class="next-cover" src="/linear-gradient(20deg,%20#0062be,%20#925696,%20#cc426e,%20#fb0347)" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ICS03 Attacklab</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/selfie.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Herbert</div><div class="author-info__description">A soul discarded</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/herbyuan"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/herbyuan" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:herbyuan@icloud.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Eventually you come...</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-1"><span class="toc-number">1.</span> <span class="toc-text">phase 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-2"><span class="toc-number">2.</span> <span class="toc-text">phase 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-3"><span class="toc-number">3.</span> <span class="toc-text">phase 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-4"><span class="toc-number">4.</span> <span class="toc-text">phase 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-5"><span class="toc-number">5.</span> <span class="toc-text">phase 5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-6"><span class="toc-number">6.</span> <span class="toc-text">phase 6</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E4%BD%BF%E7%94%A8CloudFlare%E4%BB%A3%E7%90%86%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/" title="使用CloudFlare代理个人网站">使用CloudFlare代理个人网站</a><time datetime="2023-04-01T13:04:16.000Z" title="发表于 2023-04-01 21:04:16">2023-04-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%8D%95%E7%BA%AF%E5%BD%A2%E6%B3%95%E6%B1%82%E8%A7%A3%E7%BA%BF%E6%80%A7%E8%A7%84%E5%88%92/" title="单纯形法求解线性规划">单纯形法求解线性规划</a><time datetime="2023-03-27T15:04:16.000Z" title="发表于 2023-03-27 23:04:16">2023-03-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E6%B1%82%E8%A7%A3%E7%BA%B3%E4%BB%80%E5%9D%87%E8%A1%A1%E7%82%B9/" title="求解纳什均衡点（未完成）">求解纳什均衡点（未完成）</a><time datetime="2023-03-25T15:09:17.000Z" title="发表于 2023-03-25 23:09:17">2023-03-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%9F%BA%E4%BA%8Excfe4%E5%92%8Cxrdp%E7%9A%84WSL%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2/" title="基于xcfe4和xrdp的WSL图形界面">基于xcfe4和xrdp的WSL图形界面</a><time datetime="2023-03-23T05:47:41.000Z" title="发表于 2023-03-23 13:47:41">2023-03-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E4%B8%80%E8%88%AC%E5%9D%87%E8%A1%A1%E4%B8%8E%E9%98%BF%E7%BD%97%E5%BE%B7%E5%B8%83%E9%B2%81%E5%B8%82%E5%9C%BA/" title="一般均衡与阿罗德布鲁市场">一般均衡与阿罗德布鲁市场</a><time datetime="2023-03-19T11:47:44.000Z" title="发表于 2023-03-19 19:47:44">2023-03-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Herbert</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>